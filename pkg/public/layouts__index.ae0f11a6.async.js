"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[717],{81737:function(M,N,l){l.d(N,{Fp:function(){return L},sV:function(){return h}});var w=l(54306),R=l.n(w),A=l(62086),p=l(93236),b=l(21140),I=l.n(b),C=l(63466),k=l.n(C),x=l(57810),s;(function(c){c.QUERY="Query",c.MSG="Msg",c.CONNECTION_BROADCAST="ConnectionBroadcast",c.DISCONNECTION_BROADCAST="DisconnectionBroadcast",c.QUERY_RESPONSE="QueryResponse",c.NATIVE_API_RESPONSE="NativeAPIResponse",c.NATIVE_API_RESPONSE_ASYNC="NativeAPIResponse_Async",c.WEB_API_RESPONSE="WebAPIResponse"})(s||(s={}));var E=function(){function c(n){I()(this,c);var e;console.log("AirtSocketClient constructor");var t=n.hostname,i=t===void 0?(e=window.location.hostname)!==null&&e!==void 0?e:"127.0.0.1":t,r=n.port,o=r===void 0?"8040":r,a=n.namespace,g=a===void 0?"/AIRT":a,f=n.UserRole,d=n.UserGroup,u=d===void 0?"AirtChannel":d;this.UserRole=f,this.config=n,this.entities=new Map,this.socket=x.ZP("http://".concat(i,":").concat(o).concat(g),{query:{UserRole:f,UserGroup:u},transports:["websocket"]}),this.onWebAPI(),this.onQuery(),this.initDevtool()}return k()(c,[{key:"initDefaultConfig",value:function(){this.config=Object.assign(this.config,this.getDefaultConfig())}},{key:"getDefaultConfig",value:function(){var e;return{hostname:(e=window.location.hostname)!==null&&e!==void 0?e:"127.0.0.1",port:"8040",namespace:"/AIRT",UserGroup:"AirtChannel",devtool:!1}}},{key:"initSocketIO",value:function(){var e=this.config,t=e.hostname,i=e.port,r=e.namespace,o=e.UserRole,a=e.UserGroup,g="http://".concat(t,":").concat(i).concat(r);this.socket=x.ZP(g,{query:{UserRole:o,UserGroup:a},transports:["websocket"]})}},{key:"registerEntity",value:function(e,t){this.entities.set(e,t)}},{key:"getEntity",value:function(e){return this.entities.get(e)}},{key:"formatLog",value:function(e,t){this.config.devtool&&console.log("%c[AirtSocketClientDevLog  ".concat(e,"]"),"color: darkred;",t)}},{key:"initDevtool",value:function(){var e=this;this.onConnect(function(t){return e.formatLog("onConnect",t)}),this.onDisconnect(function(t){return e.formatLog("onDisconnect",t)}),this.onWebAPIResponse(function(t){return e.formatLog("onWebAPIResponse",t)}),this.onNativeAPIResponse(function(t){return e.formatLog("onNativeAPIResponse",t)}),this.onNativeAPIResponseAsync(function(t){return e.formatLog("onNativeAPIResponseAsync",t)})}},{key:"onConnect",value:function(e){return this.on(s.CONNECTION_BROADCAST,e)}},{key:"onDisconnect",value:function(e){return this.on(s.DISCONNECTION_BROADCAST,e)}},{key:"onNativeAPIResponse",value:function(e){return this.on(s.NATIVE_API_RESPONSE,e)}},{key:"onNativeAPIResponseAsync",value:function(e){return this.on(s.NATIVE_API_RESPONSE_ASYNC,e)}},{key:"onWebAPIResponse",value:function(e){return this.on(s.WEB_API_RESPONSE,e)}},{key:"onQueryResponse",value:function(e){return this.on(s.QUERY_RESPONSE,e)}},{key:"query",value:function(e){var t=e!=null?e:"All";this.socket.emit(s.QUERY,{Entity:t})}},{key:"airtEmit",value:function(e){this.socket.emit(s.MSG,e)}},{key:"onMsg",value:function(e){this.on(s.MSG,e)}},{key:"on",value:function(e,t){var i=this;return this.socket.on(e,t),function(){i.socket.off(e,t)}}},{key:"onMsgOnce",value:function(e){this.socket.once(s.MSG,e)}},{key:"onWebAPI",value:function(){console.log("Had on Msg");var e=this;this.onMsg(function(t){var i=t.WebAPI,r=t.Entity;if(console.log("Got Msg from Node:",t),i&&e.entities.has(r)){var o=e.getEntity(r);o.applyWebAPI(t)}})}},{key:"emitAPIResponse",value:function(e){this.formatLog("emitAPIResponse: ",e),this.socket.emit(s.WEB_API_RESPONSE,e)}},{key:"onQuery",value:function(){var e=this;this.on(s.QUERY,function(t){e.config.webApiJson&&e.emitQueryResponse(Object.assign({InvokerInfo:t.InvokerInfo},e.config.webApiJson))})}},{key:"emitQueryResponse",value:function(e){this.formatLog("emitQueryResponse",e)}}]),c}(),m=p.createContext(null),L=function(n){var e=n.config,t=n.children,i=(0,p.useState)(null),r=R()(i,2),o=r[0],a=r[1],g=(0,p.useState)(e),f=R()(g,2),d=f[0],u=f[1];return(0,p.useEffect)(function(){console.log("config change"),JSON.stringify(d)!==JSON.stringify(e)&&(o&&o.socket.disconnect(),a(new E(e)),u(e))},[e]),(0,p.useEffect)(function(){return console.log("AirSocketProvider init"),a(new E(e)),u(e),function(){o&&o.socket.disconnect(),console.log("AirSocketProvider remove")}},[]),(0,A.jsx)(m.Provider,Object.assign({value:o},{children:o?t:null}))},W=l(37635),T=l.n(W),P=function(n){var e,t=(e=Object.prototype.toString.call(n).match(/\[object (.*?)\]/))===null||e===void 0?void 0:e[1];return t.toLowerCase()},v=function(n){var e="[AirtSocketIOClient Error] ".concat(n);return console.error(e)},j=function(){function c(n,e){I()(this,c),this.name=n,this.manager=e,this.apis=new Map,this.apiStack=new Set}return k()(c,[{key:"registerAPI",value:function(e,t){var i=this;T()(e)==="object"?Object.entries(e).forEach(function(r){var o=R()(r,2),a=o[0],g=o[1];i.setAPI(a,g)}):typeof e=="string"&&t?this.setAPI(e,t):typeof e!="string"&&v("apiName should be string or object, but get ".concat(P(e)))}},{key:"unregisterAPI",value:function(e){var t=this;Array.isArray(e)?e.forEach(function(i){t.apis.delete(i)}):typeof e=="string"?t.apis.delete(e):v("apiName should be string or string[], but get".concat(P(e)))}},{key:"setAPI",value:function(e,t){if(P(t)!=="function"&&v("callback should be function, but get ".concat(P(t))),t===this.apis.get(e))return!1;e!==""?(this.manager.formatLog("registerAPI",{apiName:e,callback:t}),this.apis.set(e,t)):v("apiName is not allowed to be null")}},{key:"applyWebAPI",value:function(e){var t=this;if(!e.WebAPI){v("WebAPI is required");return}Object.entries(e.WebAPI).forEach(function(i){var r=R()(i,2),o=r[0],a=r[1],g=a.Parms,f;if(t.manager.formatLog("applyWebAPI",{apiName:o,Parms:g}),t.apis.has(o)){t.apis.get(o)(g);var d=new Date().getTime(),u=new Date().getTime();f={Entity:t.name,InvokedWebAPI:o,InvokerInfo:e.InvokerInfo,InvokedResponseCode:200,Msg:"Entity: ".concat(t.name,": WebAPI: ").concat(o,", with Params Num ").concat("1",", TimeCost: ").concat("".concat(u-d),"ms")}}else f={Entity:t.name,InvokedWebAPI:o,InvokerInfo:e.InvokerInfo,InvokedResponseCode:404,Msg:"Entity: ".concat(t.name,": WebAPI: ").concat(o,", ").concat(o," is not registered")};t.manager.emitAPIResponse(f)})}}]),c}(),h=function(){var n=(0,p.useContext)(m),e=(0,p.useMemo)(function(){var t=null;n===null&&v("useSocket must be uesed in Provider");var i=n?n.UserRole:"";return i===""&&v("config.name can not be null"),n&&n.getEntity(i)?t=n.getEntity(i):n&&(t=new j(i,n)),t},[n]);return n&&e&&n.registerEntity(e.name,e),n&&e?{socket:n.socket,entity:n.entities,config:n.config,apis:e.apis,manager:e.manager,setAPI:e.setAPI,registerAPI:e.registerAPI,unregisterAPI:e.unregisterAPI,onConnect:n.onConnect,onDisconnect:n.onDisconnect,onQueryResponse:n.onQueryResponse,onNativeAPIResponse:n.onNativeAPIResponse,onNativeAPIResponseAsync:n.onNativeAPIResponseAsync,onWebAPIResponse:n.onWebAPIResponse,query:n.query,airtEmit:n.airtEmit,onMsg:n.onMsg,onMsgOnce:n.onMsgOnce,on:n.on}:null}},20614:function(M,N,l){l.r(N),l.d(N,{default:function(){return e}});var w=l(57213),R=l.n(w),A=l(57389),p=l(93236);let b=null,I="",C="",k=null,x=null,s=1,E=!1,m=!1;const L={init(t={},i=!0){i&&console.log("%cautofit.js is running","font-weight: bold; color: #ffb712; background:linear-gradient(-45deg, #bd34fe 50%, #47caff 50% );background: -webkit-linear-gradient( 120deg, #bd34fe 30%, #41d1ff );background-clip: text;-webkit-background-clip: text; -webkit-text-fill-color:linear-gradient( -45deg, #bd34fe 50%, #47caff 50% ); padding: 8px 12px; border-radius: 4px;");const{dw:r=1920,dh:o=929,el:a=typeof t=="string"?t:"#app",resize:g=!0,ignore:f=[],transition:d="none",delay:u=0}=t;b=a;let y=document.querySelector(a);if(!y){console.error(`autofit: '${a}' is not exist`);return}const S=document.createElement("style"),O=document.createElement("style");S.lang="text/css",O.lang="text/css",S.id="autofit-style",O.id="ignoreStyle",S.innerHTML="body {overflow: hidden;}",y.appendChild(S),y.appendChild(O),y.style.height=`${o}px`,y.style.width=`${r}px`,y.style.transformOrigin="0 0",P(r,o,y,f),k=()=>{clearTimeout(x),u!=0?x=setTimeout(()=>{P(r,o,y,f),m&&W(I,C)},u):(P(r,o,y,f),m&&W(I,C))},g&&window.addEventListener("resize",k),E=!0,setTimeout(()=>{y.style.transition=`${d}s`})},off(t="#app"){try{m=!1,window.removeEventListener("resize",k),document.querySelector("#autofit-style").remove(),document.querySelector(b||t).style="",m&&T()}catch(i){console.error("autofit: Failed to remove normally",i),E=!1}E&&console.log("%cautofit.js is off","font-weight: bold;color: #707070; background: #c9c9c9; padding: 8px 12px; border-radius: 4px;")}};function W(t,i=1){E||console.error("autofit.js\uFF1Aautofit has not been initialized yet"),!t&&console.error(`autofit.js\uFF1Abad selector: ${t}`),I=t,C=i;const r=document.querySelectorAll(t);if(r.length==0){console.error("autofit.js\uFF1AelRectification found no element");return}for(let o of r){m||(o.originalWidth=o.clientWidth,o.originalHeight=o.clientHeight);let a=s==1?1:s*i;o.style.width=`${o.originalWidth*a}px`,o.style.height=`${o.originalHeight*a}px`,o.style.transform=`scale(${1/s})`,o.style.transformOrigin="0 0"}m=!0}function T(){if(I)for(let t of document.querySelectorAll(I))t.style.width="",t.style.height="",t.style.transform=""}function P(t,i,r,o){let a=document.documentElement.clientHeight,g=document.documentElement.clientWidth;s=g/a<t/i?g/t:a/i,r.style.height=`${a/s}px`,r.style.width=`${g/s}px`,r.style.transform=`scale(${s})`;const f=document.querySelector("#ignoreStyle");f.innerHTML="";for(let d of o){let u=d.el||d.dom;if(typeof d=="string"&&(u=d),!u){console.error(`autofit: bad selector: ${u}`);continue}let y=d.scale?d.scale:1/s,S=y!=s?d.fontSize:"autofit",O=y!=s?d.width:"autofit",$=y!=s?d.height:"autofit";new RegExp(`${u}( |{)`,"gm").test(f.innerHTML)||(f.innerHTML+=`
${u} { 
      transform: scale(${y})!important;
      transform-origin: 0 0;
      width: ${O}!important;
      height: ${$}!important;
    }`,S&&(f.innerHTML+=`
${u} div ,${u} span,${u} a,${u} * {
        font-size: ${S}px;
      }`))}}var v=L,j=l(81737),h=l(62086),c={port:"8040",UserGroup:"AIRTGroup",namespace:"/AIRT",hostname:window.location.hostname},n=function(){var i=(0,A.useLocation)(),r=i.pathname,o=(0,p.useRef)(null);(0,p.useEffect)(function(){document.getElementById("global-layout")&&v.init({el:"#global-layout",dh:2160,dw:3840,resize:!0,ignore:[{el:".gaodeMap"}]}),document.getElementById("comparison-layout")&&v.init({el:"#comparison-layout",dh:688,dw:1104,resize:!0}),document.getElementById("economy-layout")&&v.init({el:"#economy-layout",dh:144,dw:385,resize:!0}),document.getElementById("columnar-layout")&&v.init({el:"#columnar-layout",dh:147,dw:187,resize:!0})});var a=function(){return r.includes("/doubleColumnar")?(0,h.jsx)("div",{id:"columnar-layout",style:{width:"385px",height:"144px",background:"transparent"},children:(0,h.jsx)(A.Outlet,{})}):r.includes("/economyIndex")?(0,h.jsx)("div",{id:"economy-layout",style:{width:"385px",height:"144px",background:"transparent"},children:(0,h.jsx)(A.Outlet,{})}):r.includes("/comparisonModal")?(0,h.jsx)("div",{id:"comparison-layout",style:{width:"1104px",height:"688px",background:"transparent"},children:(0,h.jsx)(A.Outlet,{})}):r.includes("/control")?(0,h.jsx)(j.Fp,{config:R()({UserRole:"WebControl"},c),children:(0,h.jsx)("div",{id:"control-bg",style:{width:"750px",height:"630px",background:"#FFF"},children:(0,h.jsx)(A.Outlet,{})})}):(0,h.jsx)("div",{id:"global-layout",className:"global-layout",children:(0,h.jsx)(j.Fp,{config:R()({UserRole:"WebClient"},c),children:(0,h.jsx)(A.Outlet,{})})})};return(0,h.jsx)(h.Fragment,{children:a()})},e=n}}]);
