"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{81737:function(M,p,i){i.d(p,{Fp:function(){return O},sV:function(){return g}});var b=i(54306),d=i.n(b),E=i(62086),A=i(93236),h=i(21140),R=i.n(h),k=i(63466),S=i.n(k),N=i(57810),u;(function(r){r.QUERY="Query",r.MSG="Msg",r.CONNECTION_BROADCAST="ConnectionBroadcast",r.DISCONNECTION_BROADCAST="DisconnectionBroadcast",r.QUERY_RESPONSE="QueryResponse",r.NATIVE_API_RESPONSE="NativeAPIResponse",r.NATIVE_API_RESPONSE_ASYNC="NativeAPIResponse_Async",r.WEB_API_RESPONSE="WebAPIResponse"})(u||(u={}));var C=function(){function r(t){R()(this,r);var e;console.log("AirtSocketClient constructor");var n=t.hostname,a=n===void 0?(e=window.location.hostname)!==null&&e!==void 0?e:"127.0.0.1":n,c=t.port,s=c===void 0?"8040":c,l=t.namespace,f=l===void 0?"/AIRT":l,v=t.UserRole,P=t.UserGroup,o=P===void 0?"AirtChannel":P;this.UserRole=v,this.config=t,this.entities=new Map,this.socket=N.ZP("http://".concat(a,":").concat(s).concat(f),{query:{UserRole:v,UserGroup:o},transports:["websocket"]}),this.onWebAPI(),this.onQuery(),this.initDevtool()}return S()(r,[{key:"initDefaultConfig",value:function(){this.config=Object.assign(this.config,this.getDefaultConfig())}},{key:"getDefaultConfig",value:function(){var e;return{hostname:(e=window.location.hostname)!==null&&e!==void 0?e:"127.0.0.1",port:"8040",namespace:"/AIRT",UserGroup:"AirtChannel",devtool:!1}}},{key:"initSocketIO",value:function(){var e=this.config,n=e.hostname,a=e.port,c=e.namespace,s=e.UserRole,l=e.UserGroup,f="http://".concat(n,":").concat(a).concat(c);this.socket=N.ZP(f,{query:{UserRole:s,UserGroup:l},transports:["websocket"]})}},{key:"registerEntity",value:function(e,n){this.entities.set(e,n)}},{key:"getEntity",value:function(e){return this.entities.get(e)}},{key:"formatLog",value:function(e,n){this.config.devtool&&console.log("%c[AirtSocketClientDevLog  ".concat(e,"]"),"color: darkred;",n)}},{key:"initDevtool",value:function(){var e=this;this.onConnect(function(n){return e.formatLog("onConnect",n)}),this.onDisconnect(function(n){return e.formatLog("onDisconnect",n)}),this.onWebAPIResponse(function(n){return e.formatLog("onWebAPIResponse",n)}),this.onNativeAPIResponse(function(n){return e.formatLog("onNativeAPIResponse",n)}),this.onNativeAPIResponseAsync(function(n){return e.formatLog("onNativeAPIResponseAsync",n)})}},{key:"onConnect",value:function(e){return this.on(u.CONNECTION_BROADCAST,e)}},{key:"onDisconnect",value:function(e){return this.on(u.DISCONNECTION_BROADCAST,e)}},{key:"onNativeAPIResponse",value:function(e){return this.on(u.NATIVE_API_RESPONSE,e)}},{key:"onNativeAPIResponseAsync",value:function(e){return this.on(u.NATIVE_API_RESPONSE_ASYNC,e)}},{key:"onWebAPIResponse",value:function(e){return this.on(u.WEB_API_RESPONSE,e)}},{key:"onQueryResponse",value:function(e){return this.on(u.QUERY_RESPONSE,e)}},{key:"query",value:function(e){var n=e!=null?e:"All";this.socket.emit(u.QUERY,{Entity:n})}},{key:"airtEmit",value:function(e){this.socket.emit(u.MSG,e)}},{key:"onMsg",value:function(e){this.on(u.MSG,e)}},{key:"on",value:function(e,n){var a=this;return this.socket.on(e,n),function(){a.socket.off(e,n)}}},{key:"onMsgOnce",value:function(e){this.socket.once(u.MSG,e)}},{key:"onWebAPI",value:function(){console.log("Had on Msg");var e=this;this.onMsg(function(n){var a=n.WebAPI,c=n.Entity;if(console.log("Got Msg from Node:",n),a&&e.entities.has(c)){var s=e.getEntity(c);s.applyWebAPI(n)}})}},{key:"emitAPIResponse",value:function(e){this.formatLog("emitAPIResponse: ",e),this.socket.emit(u.WEB_API_RESPONSE,e)}},{key:"onQuery",value:function(){var e=this;this.on(u.QUERY,function(n){e.config.webApiJson&&e.emitQueryResponse(Object.assign({InvokerInfo:n.InvokerInfo},e.config.webApiJson))})}},{key:"emitQueryResponse",value:function(e){this.formatLog("emitQueryResponse",e)}}]),r}(),m=A.createContext(null),O=function(t){var e=t.config,n=t.children,a=(0,A.useState)(null),c=d()(a,2),s=c[0],l=c[1],f=(0,A.useState)(e),v=d()(f,2),P=v[0],o=v[1];return(0,A.useEffect)(function(){console.log("config change"),JSON.stringify(P)!==JSON.stringify(e)&&(s&&s.socket.disconnect(),l(new C(e)),o(e))},[e]),(0,A.useEffect)(function(){return console.log("AirSocketProvider init"),l(new C(e)),o(e),function(){s&&s.socket.disconnect(),console.log("AirSocketProvider remove")}},[]),(0,E.jsx)(m.Provider,Object.assign({value:s},{children:s?n:null}))},W=i(37635),T=i.n(W),y=function(t){var e,n=(e=Object.prototype.toString.call(t).match(/\[object (.*?)\]/))===null||e===void 0?void 0:e[1];return n.toLowerCase()},I=function(t){var e="[AirtSocketIOClient Error] ".concat(t);return console.error(e)},D=function(){function r(t,e){R()(this,r),this.name=t,this.manager=e,this.apis=new Map,this.apiStack=new Set}return S()(r,[{key:"registerAPI",value:function(e,n){var a=this;T()(e)==="object"?Object.entries(e).forEach(function(c){var s=d()(c,2),l=s[0],f=s[1];a.setAPI(l,f)}):typeof e=="string"&&n?this.setAPI(e,n):typeof e!="string"&&I("apiName should be string or object, but get ".concat(y(e)))}},{key:"unregisterAPI",value:function(e){var n=this;Array.isArray(e)?e.forEach(function(a){n.apis.delete(a)}):typeof e=="string"?n.apis.delete(e):I("apiName should be string or string[], but get".concat(y(e)))}},{key:"setAPI",value:function(e,n){if(y(n)!=="function"&&I("callback should be function, but get ".concat(y(n))),n===this.apis.get(e))return!1;e!==""?(this.manager.formatLog("registerAPI",{apiName:e,callback:n}),this.apis.set(e,n)):I("apiName is not allowed to be null")}},{key:"applyWebAPI",value:function(e){var n=this;if(!e.WebAPI){I("WebAPI is required");return}Object.entries(e.WebAPI).forEach(function(a){var c=d()(a,2),s=c[0],l=c[1],f=l.Parms,v;if(n.manager.formatLog("applyWebAPI",{apiName:s,Parms:f}),n.apis.has(s)){n.apis.get(s)(f);var P=new Date().getTime(),o=new Date().getTime();v={Entity:n.name,InvokedWebAPI:s,InvokerInfo:e.InvokerInfo,InvokedResponseCode:200,Msg:"Entity: ".concat(n.name,": WebAPI: ").concat(s,", with Params Num ").concat("1",", TimeCost: ").concat("".concat(o-P),"ms")}}else v={Entity:n.name,InvokedWebAPI:s,InvokerInfo:e.InvokerInfo,InvokedResponseCode:404,Msg:"Entity: ".concat(n.name,": WebAPI: ").concat(s,", ").concat(s," is not registered")};n.manager.emitAPIResponse(v)})}}]),r}(),g=function(){var t=(0,A.useContext)(m),e=(0,A.useMemo)(function(){var n=null;t===null&&I("useSocket must be uesed in Provider");var a=t?t.UserRole:"";return a===""&&I("config.name can not be null"),t&&t.getEntity(a)?n=t.getEntity(a):t&&(n=new D(a,t)),n},[t]);return t&&e&&t.registerEntity(e.name,e),t&&e?{socket:t.socket,entity:t.entities,config:t.config,apis:e.apis,manager:e.manager,setAPI:e.setAPI,registerAPI:e.registerAPI,unregisterAPI:e.unregisterAPI,onConnect:t.onConnect,onDisconnect:t.onDisconnect,onQueryResponse:t.onQueryResponse,onNativeAPIResponse:t.onNativeAPIResponse,onNativeAPIResponseAsync:t.onNativeAPIResponseAsync,onWebAPIResponse:t.onWebAPIResponse,query:t.query,airtEmit:t.airtEmit,onMsg:t.onMsg,onMsgOnce:t.onMsgOnce,on:t.on}:null}},60044:function(M,p,i){i.r(p),i.d(p,{default:function(){return W}});var b=i(54306),d=i.n(b),E=i(93236),A=i(4793),h=i(57389),R=i(81737),k=i(5726),S=i.n(k),N=i(38066),u=i(83440),C=i(74210),m=i(62086);S().locale("zh-cn");var O=function(y){var I=y.global_bg,D=y.dispatch,g=(0,R.sV)(),r=(0,E.useState)("Theme1"),t=d()(r,2),e=t[0],n=t[1],a=h.history.location.state,c=(0,h.useLocation)();console.log(c.state),(0,E.useEffect)(function(){},[]);var s=(0,E.useState)({ThemeName:"Theme1",Vis:!1}),l=d()(s,2),f=l[0],v=l[1];(0,E.useEffect)(function(){return g&&g.registerAPI("API_WebLabel",function(o){console.log("API_WebLabel_Params",o.SetLabel),n(o.SetLabel)}),function(){g&&g.unregisterAPI("API_WebLabel")}},[f]),(0,E.useEffect)(function(){return g&&g.registerAPI("API_WebAnimation",function(o){if(console.log("\u8BB2\u89E3\u6A21\u5F0F",o),v(o),(o.ThemeName==="Theme1"||o.ThemeName==="Theme2"||o.ThemeName==="Theme3")&&o.Vis){h.history.push("/home/ElectricityOverview");return}else if((o.ThemeName==="Theme4"||o.ThemeName==="Theme5")&&o.Vis){h.history.push("/home/ElectricityAnalysis");return}else if((o.ThemeName==="Theme6"||o.ThemeName==="Theme7"||o.ThemeName==="Theme8"||o.ThemeName==="Theme9")&&o.Vis){h.history.push("/home/ElectricityPerformance");return}else if(o.ThemeName==="Feasibility1"&&o.Vis){h.history.push("/home/ExpandOverview");return}else if(o.ThemeName==="Feasibility2"&&o.Vis){h.history.push("/home/ExpandAnalysis");return}else if(o.ThemeName==="Feasibility3"&&o.Vis){h.history.push("/home/ExpandPerformance");return}}),function(){g&&g.unregisterAPI("API_WebAnimation")}},[f]);var P=function(){return(0,m.jsx)("div",{className:e||"Theme1"})};return(0,m.jsxs)("div",{className:"home-page-content",children:[(0,m.jsx)("div",{className:"home-page-header",children:P()}),(0,m.jsx)(A.ZP,{locale:N.Z,children:(0,m.jsx)(h.Outlet,{context:{themeModule:f}})})]})},W=(0,C.$j)(function(T){var y=T.global;return{global_bg:y.global_bg}})(O)}}]);
