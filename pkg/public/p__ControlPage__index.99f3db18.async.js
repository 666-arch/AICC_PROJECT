"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[923],{81737:function(x,S,a){a.d(S,{Fp:function(){return D},sV:function(){return C}});var M=a(54306),p=a.n(M),W=a(62086),u=a(93236),j=a(21140),N=a.n(j),T=a(63466),k=a.n(T),d=a(57810),y;(function(f){f.QUERY="Query",f.MSG="Msg",f.CONNECTION_BROADCAST="ConnectionBroadcast",f.DISCONNECTION_BROADCAST="DisconnectionBroadcast",f.QUERY_RESPONSE="QueryResponse",f.NATIVE_API_RESPONSE="NativeAPIResponse",f.NATIVE_API_RESPONSE_ASYNC="NativeAPIResponse_Async",f.WEB_API_RESPONSE="WebAPIResponse"})(y||(y={}));var b=function(){function f(t){N()(this,f);var e;console.log("AirtSocketClient constructor");var n=t.hostname,h=n===void 0?(e=window.location.hostname)!==null&&e!==void 0?e:"127.0.0.1":n,m=t.port,i=m===void 0?"8040":m,o=t.namespace,l=o===void 0?"/AIRT":o,s=t.UserRole,r=t.UserGroup,c=r===void 0?"AirtChannel":r;this.UserRole=s,this.config=t,this.entities=new Map,this.socket=d.ZP("http://".concat(h,":").concat(i).concat(l),{query:{UserRole:s,UserGroup:c},transports:["websocket"]}),this.onWebAPI(),this.onQuery(),this.initDevtool()}return k()(f,[{key:"initDefaultConfig",value:function(){this.config=Object.assign(this.config,this.getDefaultConfig())}},{key:"getDefaultConfig",value:function(){var e;return{hostname:(e=window.location.hostname)!==null&&e!==void 0?e:"127.0.0.1",port:"8040",namespace:"/AIRT",UserGroup:"AirtChannel",devtool:!1}}},{key:"initSocketIO",value:function(){var e=this.config,n=e.hostname,h=e.port,m=e.namespace,i=e.UserRole,o=e.UserGroup,l="http://".concat(n,":").concat(h).concat(m);this.socket=d.ZP(l,{query:{UserRole:i,UserGroup:o},transports:["websocket"]})}},{key:"registerEntity",value:function(e,n){this.entities.set(e,n)}},{key:"getEntity",value:function(e){return this.entities.get(e)}},{key:"formatLog",value:function(e,n){this.config.devtool&&console.log("%c[AirtSocketClientDevLog  ".concat(e,"]"),"color: darkred;",n)}},{key:"initDevtool",value:function(){var e=this;this.onConnect(function(n){return e.formatLog("onConnect",n)}),this.onDisconnect(function(n){return e.formatLog("onDisconnect",n)}),this.onWebAPIResponse(function(n){return e.formatLog("onWebAPIResponse",n)}),this.onNativeAPIResponse(function(n){return e.formatLog("onNativeAPIResponse",n)}),this.onNativeAPIResponseAsync(function(n){return e.formatLog("onNativeAPIResponseAsync",n)})}},{key:"onConnect",value:function(e){return this.on(y.CONNECTION_BROADCAST,e)}},{key:"onDisconnect",value:function(e){return this.on(y.DISCONNECTION_BROADCAST,e)}},{key:"onNativeAPIResponse",value:function(e){return this.on(y.NATIVE_API_RESPONSE,e)}},{key:"onNativeAPIResponseAsync",value:function(e){return this.on(y.NATIVE_API_RESPONSE_ASYNC,e)}},{key:"onWebAPIResponse",value:function(e){return this.on(y.WEB_API_RESPONSE,e)}},{key:"onQueryResponse",value:function(e){return this.on(y.QUERY_RESPONSE,e)}},{key:"query",value:function(e){var n=e!=null?e:"All";this.socket.emit(y.QUERY,{Entity:n})}},{key:"airtEmit",value:function(e){this.socket.emit(y.MSG,e)}},{key:"onMsg",value:function(e){this.on(y.MSG,e)}},{key:"on",value:function(e,n){var h=this;return this.socket.on(e,n),function(){h.socket.off(e,n)}}},{key:"onMsgOnce",value:function(e){this.socket.once(y.MSG,e)}},{key:"onWebAPI",value:function(){console.log("Had on Msg");var e=this;this.onMsg(function(n){var h=n.WebAPI,m=n.Entity;if(console.log("Got Msg from Node:",n),h&&e.entities.has(m)){var i=e.getEntity(m);i.applyWebAPI(n)}})}},{key:"emitAPIResponse",value:function(e){this.formatLog("emitAPIResponse: ",e),this.socket.emit(y.WEB_API_RESPONSE,e)}},{key:"onQuery",value:function(){var e=this;this.on(y.QUERY,function(n){e.config.webApiJson&&e.emitQueryResponse(Object.assign({InvokerInfo:n.InvokerInfo},e.config.webApiJson))})}},{key:"emitQueryResponse",value:function(e){this.formatLog("emitQueryResponse",e)}}]),f}(),O=u.createContext(null),D=function(t){var e=t.config,n=t.children,h=(0,u.useState)(null),m=p()(h,2),i=m[0],o=m[1],l=(0,u.useState)(e),s=p()(l,2),r=s[0],c=s[1];return(0,u.useEffect)(function(){console.log("config change"),JSON.stringify(r)!==JSON.stringify(e)&&(i&&i.socket.disconnect(),o(new b(e)),c(e))},[e]),(0,u.useEffect)(function(){return console.log("AirSocketProvider init"),o(new b(e)),c(e),function(){i&&i.socket.disconnect(),console.log("AirSocketProvider remove")}},[]),(0,W.jsx)(O.Provider,Object.assign({value:i},{children:i?n:null}))},L=a(37635),A=a.n(L),E=function(t){var e,n=(e=Object.prototype.toString.call(t).match(/\[object (.*?)\]/))===null||e===void 0?void 0:e[1];return n.toLowerCase()},g=function(t){var e="[AirtSocketIOClient Error] ".concat(t);return console.error(e)},R=function(){function f(t,e){N()(this,f),this.name=t,this.manager=e,this.apis=new Map,this.apiStack=new Set}return k()(f,[{key:"registerAPI",value:function(e,n){var h=this;A()(e)==="object"?Object.entries(e).forEach(function(m){var i=p()(m,2),o=i[0],l=i[1];h.setAPI(o,l)}):typeof e=="string"&&n?this.setAPI(e,n):typeof e!="string"&&g("apiName should be string or object, but get ".concat(E(e)))}},{key:"unregisterAPI",value:function(e){var n=this;Array.isArray(e)?e.forEach(function(h){n.apis.delete(h)}):typeof e=="string"?n.apis.delete(e):g("apiName should be string or string[], but get".concat(E(e)))}},{key:"setAPI",value:function(e,n){if(E(n)!=="function"&&g("callback should be function, but get ".concat(E(n))),n===this.apis.get(e))return!1;e!==""?(this.manager.formatLog("registerAPI",{apiName:e,callback:n}),this.apis.set(e,n)):g("apiName is not allowed to be null")}},{key:"applyWebAPI",value:function(e){var n=this;if(!e.WebAPI){g("WebAPI is required");return}Object.entries(e.WebAPI).forEach(function(h){var m=p()(h,2),i=m[0],o=m[1],l=o.Parms,s;if(n.manager.formatLog("applyWebAPI",{apiName:i,Parms:l}),n.apis.has(i)){n.apis.get(i)(l);var r=new Date().getTime(),c=new Date().getTime();s={Entity:n.name,InvokedWebAPI:i,InvokerInfo:e.InvokerInfo,InvokedResponseCode:200,Msg:"Entity: ".concat(n.name,": WebAPI: ").concat(i,", with Params Num ").concat("1",", TimeCost: ").concat("".concat(c-r),"ms")}}else s={Entity:n.name,InvokedWebAPI:i,InvokerInfo:e.InvokerInfo,InvokedResponseCode:404,Msg:"Entity: ".concat(n.name,": WebAPI: ").concat(i,", ").concat(i," is not registered")};n.manager.emitAPIResponse(s)})}}]),f}(),C=function(){var t=(0,u.useContext)(O),e=(0,u.useMemo)(function(){var n=null;t===null&&g("useSocket must be uesed in Provider");var h=t?t.UserRole:"";return h===""&&g("config.name can not be null"),t&&t.getEntity(h)?n=t.getEntity(h):t&&(n=new R(h,t)),n},[t]);return t&&e&&t.registerEntity(e.name,e),t&&e?{socket:t.socket,entity:t.entities,config:t.config,apis:e.apis,manager:e.manager,setAPI:e.setAPI,registerAPI:e.registerAPI,unregisterAPI:e.unregisterAPI,onConnect:t.onConnect,onDisconnect:t.onDisconnect,onQueryResponse:t.onQueryResponse,onNativeAPIResponse:t.onNativeAPIResponse,onNativeAPIResponseAsync:t.onNativeAPIResponseAsync,onWebAPIResponse:t.onWebAPIResponse,query:t.query,airtEmit:t.airtEmit,onMsg:t.onMsg,onMsgOnce:t.onMsgOnce,on:t.on}:null}},45284:function(x,S,a){a.r(S),a.d(S,{default:function(){return D}});var M=a(93525),p=a.n(M),W=a(57213),u=a.n(W),j=a(54306),N=a.n(j),T=a(93236),k=a(81737),d=a(62086),y=[[{ThemeName:"Theme1",name:"\u884C\u4E1A\u80FD\u8017",selected:!1},{ThemeName:"Theme2",name:"\u533A\u57DF\u7528\u7535",selected:!1},{ThemeName:"Theme3",name:"\u7535\u529B\u4E2D\u5FC3",selected:!1}],[{ThemeName:"Theme4",name:"\u52A8\u529B\u6838\u5FC3",selected:!1},{ThemeName:"Theme5",name:"\u7EFF\u80FD\u5FAE\u5149",selected:!1}],[{ThemeName:"Theme6",name:"\u4EA7\u503C\u84EC\u52C3",selected:!1},{ThemeName:"Theme7",name:"\u7535\u52BF\u751F\u957F",selected:!1},{ThemeName:"Theme8",name:"\u7EFF\u7535\u6CBB\u6C61",selected:!1},{ThemeName:"Theme9",name:"\u672A\u6765\u4E4B\u57CE",selected:!1}]],b=[[{ThemeName:"",name:"\u7535\u5EA6\u7535\u4EF7",selected:!1},{ThemeName:"",name:"\u7528\u7535\u8D70\u52BF",selected:!1}],[{ThemeName:"",name:"\u533A\u57DF\u6570\u636E",selected:!1},{ThemeName:"",name:"\u884C\u4E1A\u6570\u636E",selected:!1}],[{ThemeName:"",name:"\u8054\u5316\u79D1\u6280\u80A1\u4EFD\u6709\u9650\u516C\u53F8",selected:!1},{ThemeName:"",name:"\u6D59\u6C5F\u6D77\u6B63\u836F\u4E1A\u80A1\u4EFD\u6709\u9650\u516C\u53F8",selected:!1},{ThemeName:"",name:"\u53F0\u5DDE\u68EE\u6797\u9020\u7EB8\u6709\u9650\u516C\u53F8",selected:!1}]],O=function(){var A=(0,k.sV)(),E=(0,T.useState)([{name:"\u5168\u533A\u7528\u7535",path:"/home/ElectricityOverview",selected:!1,children:[]},{name:"\u7528\u7535\u5206\u6790",path:"/home/ElectricityAnalysis",selected:!1,children:[]},{name:"\u7528\u7535\u7EE9\u6548",path:"/home/ElectricityPerformance",selected:!1,children:[]}]),g=N()(E,2),R=g[0],C=g[1],f=(0,T.useState)([{title:"\u5DE1\u6E38\u6A21\u5F0F",selected:!0},{title:"\u8BB2\u89E3\u6A21\u5F0F",selected:!1},{title:"\u53EF\u7814\u6A21\u5F0F",selected:!1}]),t=N()(f,2),e=t[0],n=t[1],h=function(l){!l&&A&&A.airtEmit({$type:"BP_ThemeManager_C_0",Entity:"BP_ThemeManager_C_0",API_LoopAnimation:{}}),n(function(s){return s.map(function(r,c){return c===l?u()(u()({},r),{},{selected:!0}):u()(u()({},r),{},{selected:!1})})}),C(function(s){return s.map(function(r,c){return u()(u()({},r),{},{selected:!1})})})},m=function(l,s){e[1].selected&&C(function(r){return r.map(function(c,I){if(c.name===l)return u()(u()({},c),{},{selected:!0,children:y[I]});var v;return(v=c.children)===null||v===void 0||v.forEach(function(P){P.selected=!1}),u()(u()({},c),{},{selected:!1})})}),e[2].selected&&(A&&A.airtEmit({Entity:"WebClient",WebAPI:{API_WebForward:{Parms:{ThemeName:"".concat(l)}}}}),C(function(r){return r.map(function(c,I){if(c.name===l)return u()(u()({},c),{},{selected:!0,children:b[I]});var v;return(v=c.children)===null||v===void 0||v.forEach(function(P){P.selected=!1}),u()(u()({},c),{},{selected:!1})})}))},i=function(l,s,r){var c=R.filter(function(P){return P.name===l});e[1].selected&&(A&&A.airtEmit({Entity:"WebClient",WebAPI:{API_WebChangeTheme:{Parms:{ThemeName:"".concat(c[0].children[r].ThemeName)}}}}),A&&A.airtEmit({$type:"BP_ThemeManager_C_0",Entity:"BP_ThemeManager_C_0",API_SetTheme:{ThemeName:"".concat(c[0].children[r].ThemeName)}}));var I=p()(R);I.forEach(function(P){P.name===l&&P.children.forEach(function(U){U.name===s?U.selected=!0:U.selected=!1})}),C(I);var v="";s==="\u7535\u5EA6\u7535\u4EF7"&&(v="Feasibility1_1"),s==="\u7528\u7535\u8D70\u52BF"&&(v="Feasibility1_2"),s==="\u533A\u57DF\u6570\u636E"&&(v="Feasibility2_1"),s==="\u884C\u4E1A\u6570\u636E"&&(v="Feasibility2_2"),s==="\u8054\u5316\u79D1\u6280\u80A1\u4EFD\u6709\u9650\u516C\u53F8"&&(v="Feasibility3_1"),s==="\u6D59\u6C5F\u6D77\u6B63\u836F\u4E1A\u80A1\u4EFD\u6709\u9650\u516C\u53F8"&&(v="Feasibility3_2"),s==="\u53F0\u5DDE\u68EE\u6797\u9020\u7EB8\u6709\u9650\u516C\u53F8"&&(v="Feasibility3_3"),e[2].selected&&A&&(A.airtEmit({$type:"BP_ThemeManager_C_",Entity:"BP_ThemeManager_C_",API_SetTheme:{ThemeName:"".concat(v)}}),A.airtEmit({Entity:"WebClient",WebAPI:{API_WebLegend:{Parms:{ThemeName:"".concat(v)}}}}))};return(0,d.jsxs)("div",{className:"control-page-content",children:[(0,d.jsxs)("div",{className:"play-modes-content",children:[(0,d.jsx)("div",{className:"play-modes-title",children:"\u64AD\u653E\u6A21\u5F0F"}),e.map(function(o,l){return(0,d.jsx)("div",{className:o.selected?"play-btn-content-checked":"play-btn-content",onClick:function(){return h(l)},children:o.title},o.title)})]}),e[0].selected?(0,d.jsx)(d.Fragment,{}):(0,d.jsxs)("div",{className:"control-btn-content",children:[(0,d.jsx)("div",{className:"parent-btn-title",children:"\u4E8C\u7EA7\u9009\u9879"}),R.map(function(o,l){var s;return(0,d.jsxs)("div",{className:"control-btn-list",children:[(0,d.jsx)("div",{className:o.selected?"parent-btn-content-checked":"parent-btn-content",onClick:function(){return m(o.name,o.selected)},children:o.name},o.name),o.selected&&(0,d.jsxs)("div",{className:"child-btn-list",children:[(0,d.jsx)("div",{className:"child-btn-title",children:"\u4E09\u7EA7\u9009\u9879"}),(s=o.children)===null||s===void 0?void 0:s.map(function(r,c){return(0,d.jsx)("div",{style:{width:"".concat(e[2].selected&&o.name==="\u7528\u7535\u7EE9\u6548"?"200px":"")},className:r.selected?"child-btn-content":"child-btn-content-checked",onClick:function(){return i(o.name,r.name,c)},children:r.name},r.name)})]})]},o.name)})]})]})},D=O}}]);
